<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<title>URL SHORTNER</title>
</head>
<body>
	<div class="container">
	<h1>URL Shortener</h1>
	<form id="short">
		<div class="mid">
			<label for="URL">Enter URL:</label>
			<input type="URL" name="url" id="URL" required>
		</div>
		<div class="mid">
			<label for="shortCode">Enter ShortCode:</label>
			<input type="text" name="shortcode" id="shortCode" required>
		</div>
		<button type="submit">Shorten</button>
	</form>
	
	<h2>Shortened URLs</h2>
	<ul id="shortener"></ul>
	</div>
	<script>
        const fetchShortenedURL=async ()=>{
			const response=await fetch("/links")
            const links=await response.json()
			console.log("links",links);
			const list=document.getElementById('shortener')
			list.innerHTML="";
			for(const[shortCode,url] of Object.entries(links))
		{
			const li=document.createElement('li')
			const truncatedURL=url.length>=30? `${url.slice(0,30)}...`:url
			li.innerHTML=`<a href="/${shortCode}" target=_blank>
		  		${window.location.origin}/${shortCode}</a>-${truncatedURL}`
				list.appendChild(li)
		}

		}

		document.getElementById("short").addEventListener('submit',async(event)=>{
			 event.preventDefault();
		
        const formData=new FormData(event.target)
		const url=formData.get('url');
		const shortCode=formData.get('shortcode')
		console.log(url,shortCode);
		
		try {
			const response=await fetch('/Shorten',{
				method:'POST',
				headers:{"Content-Type":"application/json"},
				body:JSON.stringify({url,shortCode})
			})
			if(response.ok)
			{
				fetchShortenedURL();
				alert("Data Submitted Successfully")
				event.target.reset()
			}
			else{
				const error=await response.text()
				alert(error)
				event.target.reset()
			}
	
		} catch (error) {
			console.error(error)
		}
		})
		fetchShortenedURL();
	</script>
</body>
</html>